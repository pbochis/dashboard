<dom-module id="login-page">
  <template>
    <h2 class="paper-font-display2">Login here</h2>
    <template is="dom-if" if="{{invalidLogin}}">
      <p>Invalid login</p>
    </template>
    <button id="login" on-click="login" >Login</button>
    <iron-ajax
      id="ajaxRequest"
      handle-as="json"
      on-response="onLoginResponse"
      on-error="onLoginError"
      debounce-duration="1000"
      with-credentials="true"
      >
    </iron-ajax>
  </template>
</dom-module>
<script>
  (function() {
    Polymer({
      is: 'login-page',
      properties:{
        invalidLogin:{
          type: Boolean,
          notify: true
        }
      },
      login: function(){
        this.$.ajaxRequest.method='POST';
        this.$.ajaxRequest.body = JSON.stringify({'company': "Catalysts"});
        this.$.ajaxRequest.url='http://localhost:8080/api/company/login';
        this.$.ajaxRequest.generateRequest();
      },
      onLoginResponse: function(res, req){
        var response = res.detail.response
        if(response != undefined){
          var company = response.company
          document.cookie = "companyId=" + company.id
          document.cookie = "companyName=" + company.name
          page.redirect("/")
        }else{
          this.invalidLogin = true;
        }
      },
      onLoginError: function(error){
        this.invalidLogin = true;
        console.log(error.detail)
      },
      ready: function(){
        this.invalidLogin = false;
      }
    });
  })();
</script>
